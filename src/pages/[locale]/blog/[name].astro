---
import type { BaseProps } from "@core/types/astro";
import type { LocaleName, StaticPathsItem } from "@core/types";

import BlogLayout from "@layouts/BlogLayout.astro";
import Title from "@components/atoms/Title.svelte";

import { getCollections, getCollection } from "@core/contents";

interface Parameters {
	locale: LocaleName;
	name: string;
}

type Props = BaseProps<{
	slug: string;
}>;

export const getStaticPaths = async () => {
	const posts = await getCollections("posts");
	return posts.map((post) => {
		const slug = post.id;
		const [locale, name] = slug.split("/");
		return {
			params: { locale, name },
			props: { slug },
		} as StaticPathsItem<Parameters, Props>;
	});
};

const { locale } = Astro.params;
const { slug } = Astro.props;

const post = await getCollection("posts", slug);
const { Content } = await post.render();
---

<BlogLayout title={post.must("title")} {locale}>
	<Title text={post.must("title")} />
	<Content />
</BlogLayout>
