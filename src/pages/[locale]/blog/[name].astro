---
import BlogLayout from "@layouts/BlogLayout/BlogLayout.astro";
import Container from "@components/molecules/Container/Container.astro";
import Heading from "@components/atoms/Heading/Heading.svelte";

import { getCollections, getCollection } from "@core/contents";
import { buildLocalePosts } from "@core/utils/posts";

export const getStaticPaths = async () => {
	const posts = await getCollections("posts");
	const localePosts = buildLocalePosts(posts);
	return localePosts.map((post) => {
		return {
			params: {
				locale: post.pageLocale,
				name: post.name,
			},
			props: {
				slug: post.slug,
				lang: post.locale,
				name: post.name,
			},
		};
	});
};

const { locale } = Astro.params;
const { slug, lang, name } = Astro.props;

const post = await getCollection("posts", slug);
const { Content } = await post.render();
---

<BlogLayout title={name} {locale} mainLocale={lang}>
	<Container>
		<Heading level={1}>{post.must("title")}</Heading>
		<Content frontmatter={post.data} />
	</Container>
</BlogLayout>
